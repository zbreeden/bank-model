<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Bank — Delivery Dashboard (Demo + Scenario Explorer)</title>
  <meta name="description" content="The Bank: delivery metrics (WIP, lead/cycle time, throughput, defect escape) with a built‑in scenario explorer for exec‑friendly what‑ifs." />
  <meta name="color-scheme" content="light dark" />
  <style>
    :root {
      --bg: #0c0d0f; --fg:#e9eaed; --card:#15171a; --muted:#9aa0a6; --border:#2a2d33; --accent:#4c8bf5; --good:#4caf50; --warn:#f5a14c; --bad:#e55353;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; line-height:1.5; color:var(--fg); background:var(--bg); }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .wrap { max-width: 1000px; margin: 0 auto; padding: 24px; }
    .top { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    h1 { font-size: clamp(24px, 3vw, 36px); margin: 8px 0 0; }
    .muted { color: var(--muted); }
    .btn { display:inline-block; padding:10px 16px; border-radius:12px; border:1px solid var(--border); background:var(--card); color:var(--fg); text-decoration:none; cursor:pointer; }
    .btn:hover { border-color: var(--accent); }
    .btn-cta { border-color: var(--accent); font-weight:600; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:18px; margin-top:16px; }
    .grid { display:grid; gap:16px; grid-template-columns:1fr; }
    @media (min-width: 760px) { .grid-2 { grid-template-columns: 1fr 1fr; } .grid-3 { grid-template-columns: 1fr 1fr 1fr; } }
    .sep { height:1px; background:var(--border); margin:16px 0; }
    .kpi { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border:1px solid var(--border); border-radius:12px; background:rgba(255,255,255,0.02); }
    .kpi strong { font-size:1.1rem; }
    .tag { font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid var(--border); background:rgba(255,255,255,0.04); }
    .tag.good{ border-color:var(--good); color:var(--good);} .tag.warn{ border-color:var(--warn); color:var(--warn);} .tag.bad{ border-color:var(--bad); color:var(--bad);} 
    label { display:block; font-weight:600; margin-top:10px; }
    input[type="range"], input[type="number"] { width:100%; }
    .row { display:flex; gap:12px; align-items:center; }
    .row > * { flex:1; }
    .copy { font-size:12px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
      /* Demo timer */
    .timer { position: sticky; top: 8px; z-index: 10; }
    .timer-row { display:flex; gap:8px; align-items:center; justify-content:space-between; }
    .timer-bar-wrap { height:6px; background:#1f2228; border-radius:999px; overflow:hidden; margin-top:8px; }
    .timer-bar { height:100%; width:0%; background: var(--accent); transition: width .4s ease; }
    [data-state="warn"] .timer-bar { background: var(--warn); }
    [data-state="bad"] .timer-bar { background: var(--bad); }
    .timer-ctrls { margin-top:8px; display:flex; gap:8px; flex-wrap:wrap; }
  </style>
  <script>
    // Lightweight analytics stub (safe even without GTM/GA)
    window.dataLayer = window.dataLayer || [];
    function track(event, params={}){ window.dataLayer.push({event, ts: Date.now(), ...params}); }

    // Scenario math helpers (exec-friendly, transparent)
    function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }
    function pct(delta, base){ return base === 0 ? 0 : (delta/base)*100; }

    function fmt(n){ return (Math.round(n*10)/10).toFixed(1); }

    function computeScenario(){
      const wip = parseFloat(document.getElementById('wip').value);
      const cap = parseFloat(document.getElementById('cap').value);
      const th = parseFloat(document.getElementById('throughput').value); // items/day
      const handoffs = parseInt(document.getElementById('handoffs').value,10);
      const qa = document.getElementById('qa').checked;

      const safeTh = Math.max(0.1, th); // avoid div-by-zero
      const leadNow = wip / safeTh; // Little's Law: W = L/λ => W (days) = WIP / throughput
      const wipCapped = Math.min(wip, cap);
      const leadCapped = wipCapped / safeTh;
      const leadDeltaDays = leadNow - leadCapped;
      const leadDeltaPct = pct(leadDeltaDays, leadNow);

      // Toy rework risk model: base 5% + 4% per extra handoff beyond 1; QA harness reduces by 30% relative
      const baseRisk = 0.05 + Math.max(0, handoffs-1) * 0.04;
      const risk = qa ? baseRisk * 0.7 : baseRisk;

      // Status tags
      const breach = wip > cap;

      // Update UI
      document.getElementById('lead-now').textContent = fmt(leadNow) + ' days';
      document.getElementById('lead-cap').textContent = fmt(leadCapped) + ' days';
      document.getElementById('lead-improve').textContent = (leadDeltaDays>0?'-':'') + fmt(Math.abs(leadDeltaDays)) + ' days (' + (leadDeltaPct>0?'-':'+') + fmt(Math.abs(leadDeltaPct)) + '%)';
      document.getElementById('risk').textContent = Math.round(risk*100) + '%';

      const tag = document.getElementById('breach-tag');
      tag.textContent = breach ? 'Cap Breached' : 'Within Cap';
      tag.className = 'tag ' + (breach ? 'bad' : 'good');

      // BLUF string for copy/paste into chat/email
      const bluf = `At WIP ${wip} and throughput ${fmt(safeTh)}/day, lead time ≈ ${fmt(leadNow)}d. Capping WIP at ${cap} yields ≈ ${fmt(leadCapped)}d (${leadDeltaDays>0?'-':'+'}${fmt(Math.abs(leadDeltaPct))}%). With ${handoffs} handoffs${qa? ' + QA harness':''}, estimated rework risk ≈ ${Math.round(risk*100)}%.`;
      document.getElementById('bluf').textContent = bluf;

      track('scenario_update', {wip, cap, throughput:safeTh, handoffs, qa, lead_now:leadNow, lead_capped:leadCapped, breach});
    }

    function copyBLUF(){
      const text = document.getElementById('bluf').textContent;
      navigator.clipboard.writeText(text).then(()=>{
        const btn = document.getElementById('copyBtn');
        const orig = btn.textContent; btn.textContent = 'Copied!'; setTimeout(()=>btn.textContent = orig, 1200);
      });
    }
    // Demo timer (90s) utilities
    let demoTimer=null, demoRemaining=0, demoTotal=0;
    function startTimer(seconds){ demoTotal=seconds; demoRemaining=seconds; const el=document.getElementById('timer'); updateTimerUI(); el.style.display='block'; clearInterval(demoTimer); demoTimer=setInterval(tickTimer,1000); }
    function tickTimer(){ demoRemaining=Math.max(0, demoRemaining-1); updateTimerUI(); if(demoRemaining===0){ clearInterval(demoTimer); cuePause(); } }
    function updateTimerUI(){ const r=document.getElementById('timer-remaining'); const bar=document.getElementById('timer-bar'); if(!r||!bar) return; r.textContent=`${demoRemaining}s`; const pct=((demoTotal-demoRemaining)/demoTotal)*100; bar.style.width=pct+'%'; const container=document.getElementById('timer'); if(container){ container.setAttribute('data-state', (demoRemaining<=15)?'bad':(demoRemaining<=30?'warn':'ok')); } }
    function pauseTimer(){ clearInterval(demoTimer); demoTimer=null; }
    function resumeTimer(){ if(!demoTimer && demoRemaining>0){ demoTimer=setInterval(tickTimer,1000); } }
    function addSeconds(n){ demoRemaining=Math.min(demoRemaining+n, demoTotal+n); demoTotal+=n; updateTimerUI(); }
    function resetTimer(){ clearInterval(demoTimer); demoTimer=null; demoRemaining=0; demoTotal=0; const el=document.getElementById('timer'); if(el) el.style.display='none'; }
    function cuePause(){ const cue=document.getElementById('timer-cue'); if(cue){ cue.style.display='inline'; } }

    // Keyboard controls (private): T=start/resume 90s, P=pause, H=hide
    window.addEventListener('keydown', (e)=>{
      if(e.key==='t' || e.key==='T'){ if(!demoTimer && demoRemaining===0){ startTimer(90); } else { resumeTimer(); } }
      if(e.key==='p' || e.key==='P'){ pauseTimer(); }
      if(e.key==='h' || e.key==='H'){ resetTimer(); }
    });

    window.addEventListener('DOMContentLoaded', () => {
      // Wire inputs
      ['wip','cap','throughput','handoffs','qa'].forEach(id => {
        document.getElementById(id).addEventListener('input', computeScenario);
        document.getElementById(id).addEventListener('change', computeScenario);
      });
      // Auto-scroll if hash present
      if (location.hash === '#demo-start') { document.getElementById('demo-start').scrollIntoView({behavior:'smooth'}); }
      const scen = document.getElementById('scenario'); if (scen) { scen.style.display='none'; }
      if (location.hash === '#scenario' && scen) { scen.style.display='block'; scen.scrollIntoView({behavior:'smooth'}); }); }
      computeScenario();
    });
  </script>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>The Bank</h1>
        <div class="muted">Delivery heartbeat with exec‑friendly what‑ifs: WIP, lead/cycle time, throughput, defect escape.</div>
      </div>
      <div>
        <a class="btn" href="https://zbreeden.github.io/FourTwentyAnalytics/">← Back to Hub</a>
      </div>
    </div>

    <div id="timer" class="card timer" style="display:none;">
      <div class="timer-row">
        <strong>Demo timer</strong>
        <span id="timer-remaining">90s</span>
        <span id="timer-cue" class="muted" style="display:none;"> · Pause &amp; hand to Q&amp;A?</span>
      </div>
      <div class="timer-bar-wrap"><div id="timer-bar" class="timer-bar"></div></div>
      <div class="timer-ctrls">
        <button class="btn" type="button" onclick="pauseTimer()">Pause</button>
        <button class="btn" type="button" onclick="resumeTimer()">Resume</button>
        <button class="btn" type="button" onclick="addSeconds(30)">+30s</button>
        <button class="btn" type="button" onclick="resetTimer()">Hide</button>
      </div>
    </div>

    <!-- Hero / On‑ramp -->
    <div class="card">
      <p><strong>Before we dive in:</strong> if you’d like to follow along, please open this page and click <em>Start Demo</em> below. I’ll keep this to <strong>5 minutes</strong> and then pause.</p>
      <div class="grid grid-2">
        <a class="btn btn-cta" href="#demo-start" onclick="track('demo_start_click')">▶ Start Demo</a>
        <div>
          <div class="muted">Alt links:</div>
          <div>GitHub README anchor → <a href="https://github.com/zbreeden/bank-model/blob/main/README.md#demo-start">#demo-start</a></div>
          <div>Power BI (optional viewer) → <a href="https://app.powerbi.com/reportEmbed?reportId=5ccf2c2f-2272-4165-a6a3-3d5a528a4be7&autoAuth=true&ctid=dc1332eb-e1d9-4c3f-8456">open</a></div>
        </div>
      </div>
    </div>

    <!-- Demo sequence -->
    <section id="demo-start">
      <h2>Demo Start</h2>
      <div class="card">
        <p><strong>Agenda (5 min):</strong> 3‑min delivery snapshot → 2‑min <em>The Bank</em> demo → Q&amp;A.</p>
        <p class="muted">Note: dashboard uses <strong>synthetic data</strong>; patterns mirror real workflows.</p>
        <p><a class="btn" href="#delivery-toolkit" onclick="track('next_delivery_toolkit')">Next → Delivery Toolkit Snapshot</a></p>
      </div>
    </section>

    <section id="delivery-toolkit">
      <h2>Delivery Toolkit Snapshot</h2>
      <div class="card">
        <ul>
          <li><strong>WIP caps</strong> to keep flow stable (stop‑starting, start‑finishing).</li>
          <li><strong>Lead/cycle time</strong> visible and time‑boxed.</li>
          <li><strong>Throughput</strong> tracked at steady cadence.</li>
          <li><strong>Defect escape</strong> reduced via pre‑promote <em>QA harness</em>.</li>
          <li>Smaller batches, fewer handoffs, clear <em>entry/exit</em> criteria.</li>
        </ul>
        <p><a class="btn" href="#bank-3-scene" onclick="track('next_bank_3scene')">Next → The Bank: 3‑Scene Demo</a> <a class="btn" href="#demo-start">Back ↑</a></p>
      </div>
    </section>

    <section id="bank-3-scene">
      <h2>The Bank — 3‑Scene Demo</h2>
      <div class="card">
        <ol>
          <li><strong>Heartbeat:</strong> WIP vs cap → if breached 3+ days, re‑prioritize.</li>
          <li><strong>Bottleneck:</strong> Stage‑duration view → longest wait gets a policy fix (entry/exit, fewer handoffs, smaller batches).</li>
          <li><strong>Quality:</strong> Defect escape / rework% → pre‑promote QA harness (schema/null/dupe checks).</li>
        </ol>
        <p class="muted">If the live dashboard lags, show static screenshots while it loads.</p>
        <p><a class="btn" href="#qa-wrap" onclick="track('next_qa')">Next → Q&amp;A &amp; Wrap</a> <button class="btn" onclick="document.getElementById('scenario').style.display='block'; document.getElementById('scenario').scrollIntoView({behavior:'smooth'}); track('open_scenario');">Optional → Thinking Machine (What‑If)</button> <a class="btn" href="#delivery-toolkit">Back ↑</a></p>
      </div>
    </section>

    <!-- Thinking Machine / Scenario Explorer -->
    <section id="scenario">
      <h2>Optional — Thinking Machine (What‑If) Explorer</h2>
      <div class="card">
        <div class="grid grid-3">
          <div class="kpi"><span>Cap Status</span> <span id="breach-tag" class="tag">Within Cap</span></div>
          <div class="kpi"><span>Lead Time (now)</span> <strong id="lead-now">—</strong></div>
          <div class="kpi"><span>Lead Time (at cap)</span> <strong id="lead-cap">—</strong></div>
        </div>
        <div class="kpi" style="margin-top:12px;"><span>Improvement</span> <strong id="lead-improve">—</strong></div>

        <div class="sep"></div>

        <div class="grid grid-2">
          <div>
            <label for="wip">Current WIP (items)</label>
            <input id="wip" type="range" min="1" max="30" value="8" />
            <div class="row"><input type="number" min="1" max="30" value="8" oninput="document.getElementById('wip').value=this.value; computeScenario();" /></div>
          </div>
          <div>
            <label for="cap">WIP Cap (items)</label>
            <input id="cap" type="range" min="1" max="20" value="5" />
            <div class="row"><input type="number" min="1" max="20" value="5" oninput="document.getElementById('cap').value=this.value; computeScenario();" /></div>
          </div>
        </div>

        <div class="grid grid-2">
          <div>
            <label for="throughput">Throughput (items/day)</label>
            <input id="throughput" type="range" min="0.1" max="10" step="0.1" value="2" />
            <div class="row"><input type="number" min="0.1" max="10" step="0.1" value="2" oninput="document.getElementById('throughput').value=this.value; computeScenario();" /></div>
          </div>
          <div>
            <label for="handoffs">Handoffs (count)</label>
            <input id="handoffs" type="range" min="1" max="6" value="3" />
            <div class="row"><input type="number" min="1" max="6" value="3" oninput="document.getElementById('handoffs').value=this.value; computeScenario();" /></div>
            <label class="row" style="margin-top:8px; align-items:center;">
              <input id="qa" type="checkbox" checked style="width:auto;" /> <span>QA harness enabled</span>
            </label>
          </div>
        </div>

        <div class="sep"></div>
        <p class="mono" id="bluf">—</p>
        <button id="copyBtn" class="btn copy" onclick="copyBLUF()">Copy BLUF</button>
      </div>
      <p class="muted" style="margin-top:8px;">Model notes: lead time via Little’s Law (≈ WIP / throughput). Rework risk is a simple illustrative heuristic to guide discussion, not a forecast.</p>

      <p><a class="btn" href="#qa-wrap">Next → Q&amp;A &amp; Wrap</a> <a class="btn" href="#bank-3-scene">Back ↑</a></p>
    </section>

    <!-- Q&A / Wrap -->
    <section id="qa-wrap">
      <h2>Q&amp;A and Wrap</h2>
      <div class="card">
        <ul>
          <li>90‑day success metrics?</li>
          <li>Where does work stall today (intake, review, UAT)?</li>
          <li>Toolchain &amp; request flow (SQL/PBI/Git)?</li>
          <li>Relief valve when WIP &gt; cap?</li>
          <li>Member‑impact tie‑back?</li>
        </ul>
        <p><strong>Pilot ask:</strong> “I can baseline your flow (WIP/lead‑time + QA gate) in one sprint.”</p>
        <p><a class="btn" href="#demo-start">Back to Start ↑</a></p>
      </div>
    </section>

    <div class="sep"></div>
    <p class="muted">© FourTwenty Analytics · This page records anonymous events to <span class="mono">dataLayer</span> (safe without GTM/GA).</p>
  </div>
</body>
</html>
